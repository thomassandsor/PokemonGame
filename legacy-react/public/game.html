<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Game - Universal HTML Version</title>
    <meta name="description" content="Pokemon Game - Optimized for all devices">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Pokemon Game">
    <link rel="apple-touch-icon" href="/favicon.ico">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        h1 {
            text-align: center;
            font-size: 2em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .game-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .game-section h3 {
            margin-top: 0;
            color: #ffd700;
        }
        .button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
        .button:hover, .button:active {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }
        .button.secondary {
            background: #6c757d;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
        .button.secondary:hover, .button.secondary:active {
            background: #545b62;
        }
        .button.success {
            background: #28a745;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        .button.success:hover, .button.success:active {
            background: #1e7e34;
        }
        .pokemon-display {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        .pokemon-sprite {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }
        .pokemon-info {
            flex: 1;
        }
        .pokemon-name {
            font-weight: bold;
            font-size: 18px;
        }
        .pokemon-level {
            color: #ffd700;
            font-size: 14px;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 15px;
        }
        .user-info {
            font-size: 14px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
        }
        .error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            color: #dc3545;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
            color: #28a745;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            overflow: hidden;
        }
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tab.active {
            background: rgba(255, 255, 255, 0.2);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .pokemon-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .pokemon-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        .pokemon-card.selected {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
        }
        .battle-screen {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }
        .battle-arena {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }
        .pokemon-battle-info {
            text-align: center;
            flex: 1;
        }
        .vs-text {
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .hp-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }
        .hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757 0%, #ffa502 50%, #2ed573 100%);
            transition: width 0.5s ease;
        }
        .moves-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .move-button {
            padding: 12px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .move-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .qr-scanner {
            text-align: center;
            padding: 20px;
        }
        .qr-placeholder {
            width: 200px;
            height: 200px;
            background: rgba(0, 0, 0, 0.2);
            border: 2px dashed rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            margin: 15px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        @media (max-width: 480px) {
            .container {
                margin: 0;
                padding: 15px;
                border-radius: 0;
            }
            .pokemon-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .battle-arena {
                flex-direction: column;
                gap: 20px;
            }
            .vs-text {
                transform: rotate(90deg);
                margin: 10px 0;
            }
        }
        .debug-info {
            color: #ffd700;
            font-size: 14px;
        }
        .status-bar {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        .status-success {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid #28a745;
            color: #28a745;
        }
        .status-error {
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid #dc3545;
            color: #dc3545;
        }
        .status-info {
            background: rgba(23, 162, 184, 0.2);
            border: 2px solid #17a2b8;
        }
        .status-success {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid #28a745;
        }
        .debug-section {
            margin-top: 30px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Pokemon Game</h1>
        <div id="authStatus" class="status-bar status-success">
            ‚úÖ Loading user information...
        </div>
        
        <div id="debugConsole" class="game-section" style="display: block;">
            <h3>üîç Debug Console</h3>
            <div id="debugLog" style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
                <div class="debug-info">Starting authentication check...</div>
            </div>
            <button class="button secondary" onclick="clearDebugLog()" style="margin-top: 10px; font-size: 12px; padding: 8px;">Clear Debug Log</button>
        </div>
        
        <div id="userSection" class="game-section" style="display: none;">
            <h3>üë§ Welcome Back!</h3>
            <div id="userInfo">
                <div class="pokemon-display">
                    <div class="pokemon-sprite" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-size: 24px;">üë§</div>
                    <div class="pokemon-info">
                        <div class="pokemon-name" id="userName">Loading...</div>
                        <div class="pokemon-level" id="userEmail">Verifying email...</div>
                    </div>
                </div>
                <div class="pokemon-display">
                    <div class="pokemon-sprite" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); display: flex; align-items: center; justify-content: center; font-size: 24px;">üìä</div>
                    <div class="pokemon-info">
                        <div class="pokemon-name">Game Progress</div>
                        <div class="pokemon-level" id="userStats">Level 0 ‚Ä¢ 0 Pokemon</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="game-section">
            <h3>üè† Your Pokemon Collection</h3>
            <div id="pokemonList">
                <div class="pokemon-display">
                    <img class="pokemon-sprite" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png" alt="Pikachu">
                    <div class="pokemon-info">
                        <div class="pokemon-name">Pikachu</div>
                        <div class="pokemon-level">Level 15 ‚Ä¢ Electric</div>
                    </div>
                </div>
                <div class="pokemon-display">
                    <img class="pokemon-sprite" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/1.png" alt="Bulbasaur">
                    <div class="pokemon-info">
                        <div class="pokemon-name">Bulbasaur</div>
                        <div class="pokemon-level">Level 12 ‚Ä¢ Grass/Poison</div>
                    </div>
                </div>
                <div class="pokemon-display">
                    <img class="pokemon-sprite" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/4.png" alt="Charmander">
                    <div class="pokemon-info">
                        <div class="pokemon-name">Charmander</div>
                        <div class="pokemon-level">Level 10 ‚Ä¢ Fire</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="game-section">
            <h3>‚ö° Game Actions</h3>
            <button class="button success" onclick="startBattle()">ü•ä Start Battle</button>
            <button class="button" onclick="scanPokemon()">üì± Scan Pokemon QR</button>
            <button class="button" onclick="browsePokemon()">üîç Browse Pokemon</button>
            <button class="button" onclick="evolutionLab()">üß¨ Evolution Lab</button>
        </div>

        <div class="game-section">
            <h3>üõ†Ô∏è Game Management</h3>
            <button class="button secondary" onclick="viewProfile()">üë§ View Profile</button>
            <button class="button secondary" onclick="adminPanel()">‚öôÔ∏è Admin Panel</button>
            <button class="button secondary" onclick="gameSettings()">üéõÔ∏è Settings</button>
        </div>

        <div class="game-section">
            <h3>üÜò Authentication & Troubleshooting</h3>
            <button class="button secondary" onclick="debugTools()">üîç Debug Tools</button>
            <button class="button secondary" onclick="showLoginPage()">ÔøΩ Login Page</button>
            <button class="button secondary" onclick="logout()">üö™ Logout</button>
            <button class="button secondary" onclick="clearAllData()">üßπ Reset Everything</button>
        </div>

        <div class="debug-section">
            <h4>üìä System Status</h4>
            <div id="systemStatus">Loading...</div>
        </div>
    </div>

    <!-- Application Insights -->
    <script>
        !function(T,l,y){var S=T.location,u="script",k="applicationInsightsSDK",D="ai.device.",C="toLowerCase",E="crossOrigin",I="POST",w="appInsightsSDK",x=y.name||"appInsights";(y.name||T[k])&&(T[k]=x);var P=T[x]||function(d){var g=!1,f=!1,m={initialize:!0,queue:[],sv:"4",version:2,config:d};function v(e,t){var n={},a="Browser";return n[D+"id"]=a[C](),n[D+"type"]=a,n["ai.cloud.role"]=d.loggingLevelConsole,n["ai.internal.sdkVersion"]="javascript:snippet_"+(m.sv||m.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:d.instrumentationKey,name:"Microsoft.ApplicationInsights."+x+"."+e,sampleRate:100,tags:n,data:{baseData:{name:e,properties:t}}}}function h(e,t){f||(28<m.queue.length&&(m.queue=m.queue.slice(1)),m.queue.push(v(e,t)),f||(f=!0,setTimeout(function(){f=!1,m.flush()},0)))}m.queue=[],m.flush=function(){var e=m.queue;m.queue=[],e.forEach(function(e){(function(e){var a=S.pathname.toLowerCase();if(0<=a.indexOf("vsts")||0<=a.indexOf("visualstudio")||0<=a.indexOf("microsoft"))return!1;var t=(S.hostname||"").replace(www,"");return 0<t.indexOf("msft")||"msedge"===t||0<=t.indexOf("microsoft")||0<=t.indexOf("visualstudio")||0<=t.indexOf("azure")?(console&&console.log&&console.log("AI (Internal): "+e.iKey+" will not send telemetry"),!1):!0})(e)&&(function(e,t,n,a){var i=T.fetch;if(i&&!y.useXhr)i(n,{method:I,body:JSON.stringify(e),mode:"cors"});else if(XMLHttpRequest){var r=new XMLHttpRequest;r.open(I,n),r.setRequestHeader("Content-type","application/json"),r.send(JSON.stringify(e))}})(e,"",d.endpointUrl)})},m.trackEvent=function(e,t){h("Event",{name:e,properties:t})},m.trackPageView=function(e,t,n){h("PageView",{name:e,uri:t,properties:n})},m.trackException=function(e,t){h("Exception",{exception:e,properties:t})},m.flush(),T[x]=m,m.queue=[],m.trackPageView(""),m},P=P({instrumentationKey:"a5e49ae4-0936-46c2-a6b6-b237830466dd",endpointUrl:"https://dc.applicationinsights.azure.com/v2/track"});T[x]=P,P.queue.push(function(){P.context.addTelemetryInitializer(function(e){e.tags=e.tags||{},e.tags["ai.cloud.role"]="PokemonGame-HTMLVersion"})})
    </script>

    <script>
        // Global user state
        let currentUser = null;
        let isAuthenticated = false;

        // Debug logging functions
        function debugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const debugLogElement = document.getElementById('debugLog');
            if (debugLogElement) {
                const logEntry = document.createElement('div');
                logEntry.className = 'debug-info';
                logEntry.style.marginBottom = '5px';
                logEntry.innerHTML = `[${timestamp}] ${message}`;
                debugLogElement.appendChild(logEntry);
                debugLogElement.scrollTop = debugLogElement.scrollHeight;
            }
            // Also log to browser console
            console.log(`[DEBUG ${timestamp}] ${message}`);
        }

        function clearDebugLog() {
            const debugLogElement = document.getElementById('debugLog');
            if (debugLogElement) {
                debugLogElement.innerHTML = '<div class="debug-info">Debug log cleared...</div>';
            }
        }

        // Track page load
        if (window.appInsights) {
            appInsights.trackPageView('Pokemon Game HTML Version', window.location.href);
            appInsights.trackEvent('HTML_Game_Load', {
                source: 'HTML Game Version',
                userAgent: navigator.userAgent,
                url: window.location.href,
                timestamp: new Date().toISOString()
            });
        }

        function trackAction(action, details = {}) {
            if (window.appInsights) {
                appInsights.trackEvent('HTML_Game_Action', {
                    action: action,
                    ...details,
                    source: 'HTML Game Version',
                    userAgent: navigator.userAgent,
                    timestamp: new Date().toISOString(),
                    authenticated: isAuthenticated,
                    userEmail: currentUser?.email || 'guest'
                });
            }
        }

        // Check authentication status on page load
        async function checkAuthStatus() {
            debugLog('üîç Starting authentication check...');
            
            // Check if we came from OAuth callback with error
            const urlParams = new URLSearchParams(window.location.search);
            const errorParam = urlParams.get('error');
            const tokenParam = urlParams.get('token');
            
            if (errorParam) {
                debugLog('üö® OAuth Error detected: ' + errorParam);
                document.getElementById('authStatus').innerHTML = `‚ùå Authentication Error: ${decodeURIComponent(errorParam)}`;
                document.getElementById('authStatus').className = 'status-bar status-error';
                return;
            }
            
            try {
                debugLog('üìû Calling WhoAmI endpoint...');
                
                // Use relative URL - no cross-origin issues!
                const whoAmIUrl = '/api/whoami';
                
                debugLog('üåê Endpoint URL: ' + whoAmIUrl);
                
                // If we have a token in URL params, add it to the request
                let finalUrl = whoAmIUrl;
                if (tokenParam) {
                    finalUrl += '?token=' + encodeURIComponent(tokenParam);
                    debugLog('üé´ Using token from URL parameters');
                }
                
                const response = await fetch(finalUrl, {
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                debugLog('üìã Response status: ' + response.status);
                debugLog('üìã Response headers: ' + JSON.stringify([...response.headers.entries()]));
                
                if (response.ok) {
                    const data = await response.json();
                    debugLog('‚úÖ WhoAmI response data: ' + JSON.stringify(data));
                    
                    if (data.authenticated) {
                        currentUser = data;
                        isAuthenticated = true;
                        updateUserInterface(data);
                        trackAction('User_Authenticated', { email: data.email });
                        debugLog('üéâ User authenticated successfully!');
                    } else {
                        debugLog('üë§ User not authenticated, showing guest mode');
                        showGuestMode();
                    }
                } else {
                    const errorText = await response.text();
                    debugLog('‚ùå WhoAmI request failed: ' + response.status + ' - ' + errorText);
                    document.getElementById('authStatus').innerHTML = `‚ùå Authentication check failed: ${response.status}`;
                    document.getElementById('authStatus').className = 'status-bar status-error';
                    showGuestMode();
                }
            } catch (error) {
                debugLog('üö® Auth check exception: ' + error.message);
                document.getElementById('authStatus').innerHTML = `‚ùå Network error: ${error.message}`;
                document.getElementById('authStatus').className = 'status-bar status-error';
                showGuestMode();
            }
        }

        function updateUserInterface(userData) {
            // Update user section
            document.getElementById('userName').textContent = userData.name;
            document.getElementById('userEmail').textContent = userData.email;
            document.getElementById('userStats').textContent = `Level ${userData.level} ‚Ä¢ ${userData.pokemonCount} Pokemon`;
            document.getElementById('userSection').style.display = 'block';
            
            // Update auth status
            document.getElementById('authStatus').innerHTML = '‚úÖ Authenticated via Social Login';
            document.getElementById('authStatus').className = 'status-bar status-success';
        }

        function showGuestMode() {
            // Check if we have OAuth parameters in URL
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const email = urlParams.get('email');
            const name = urlParams.get('name');
            const error = urlParams.get('error');

            if (error) {
                document.getElementById('authStatus').innerHTML = `‚ùå Login Error: ${error}`;
                document.getElementById('authStatus').className = 'status-bar error';
                trackAction('Authentication_Error', { error: error });
            } else if (token && email) {
                // OAuth redirect successful - clean URL and check auth again
                window.history.replaceState({}, document.title, window.location.pathname);
                checkAuthStatus();
                return;
            } else {
                // Guest mode
                document.getElementById('authStatus').innerHTML = 'üë§ Playing as Guest - <a href="/login.html" style="color: #ffd700;">Login for full features</a>';
                document.getElementById('authStatus').className = 'status-bar status-info';
                trackAction('Guest_Mode_Active');
            }
        }

        // Game Functions
        function startBattle() {
            trackAction('Start_Battle');
            if (isAuthenticated) {
                alert('ü•ä Battle System Loading...\n\nAuthenticated battle features:\n‚Ä¢ Your Pokemon team\n‚Ä¢ Ranked battles\n‚Ä¢ Experience tracking\n‚Ä¢ Rewards saved to your account');
            } else {
                alert('ü•ä Battle System (Guest Mode)...\n\nGuest battle features:\n‚Ä¢ Practice battles only\n‚Ä¢ No progression saved\n‚Ä¢ Login to unlock full features');
            }
        }

        function scanPokemon() {
            trackAction('Scan_Pokemon');
            if (isAuthenticated) {
                alert('üì± QR Scanner Active...\n\nAuthenticated features:\n‚Ä¢ Add to your permanent collection\n‚Ä¢ Sync across devices\n‚Ä¢ Trading with other users');
            } else {
                alert('üì± QR Scanner (Guest Mode)...\n\nGuest features:\n‚Ä¢ Temporary scan only\n‚Ä¢ No permanent collection\n‚Ä¢ Login to save Pokemon');
            }
        }

        function browsePokemon() {
            trackAction('Browse_Pokemon');
            alert('üîç Pokemon Browser...\n\nFull Pokedex with:\n‚Ä¢ All 1000+ Pokemon\n‚Ä¢ Detailed stats and info\n‚Ä¢ Evolution trees\n‚Ä¢ Type effectiveness charts\n‚Ä¢ Search and filters');
        }

        function evolutionLab() {
            trackAction('Evolution_Lab');
            if (isAuthenticated) {
                alert('üß¨ Evolution Lab...\n\nAuthenticated features:\n‚Ä¢ Evolve your Pokemon\n‚Ä¢ Track evolution history\n‚Ä¢ Permanent progress\n‚Ä¢ Achievement unlocks');
            } else {
                alert('üß¨ Evolution Lab (Guest Mode)...\n\nLimited features available\nLogin to access full evolution system');
            }
        }

        function viewProfile() {
            trackAction('View_Profile');
            if (isAuthenticated) {
                alert(`üë§ ${currentUser.name}'s Profile...\n\nYour game stats:\n‚Ä¢ Email: ${currentUser.email}\n‚Ä¢ Level: ${currentUser.level}\n‚Ä¢ Pokemon Count: ${currentUser.pokemonCount}\n‚Ä¢ Last Played: ${new Date(currentUser.lastPlayed).toLocaleDateString()}`);
            } else {
                alert('üë§ Guest Profile...\n\nLogin to access:\n‚Ä¢ Permanent profile\n‚Ä¢ Game statistics\n‚Ä¢ Achievement tracking\n‚Ä¢ Friend connections');
            }
        }

        function adminPanel() {
            trackAction('Admin_Panel');
            if (isAuthenticated) {
                alert(`‚öôÔ∏è Admin Panel - ${currentUser.email}...\n\nSeminar Management:\n‚Ä¢ Verified attendee access\n‚Ä¢ Real email confirmation\n‚Ä¢ Progress tracking\n‚Ä¢ Analytics dashboard`);
            } else {
                alert('‚öôÔ∏è Admin Panel...\n\nLogin required for admin access\nSeminar leaders need verified identity');
            }
        }

        function gameSettings() {
            trackAction('Game_Settings');
            alert('üéõÔ∏è Game Settings...\n\nCustomize your experience:\n‚Ä¢ Sound/music settings\n‚Ä¢ Notification preferences\n‚Ä¢ Display options\n‚Ä¢ Privacy settings');
        }

        function debugTools() {
            trackAction('Debug_Tools');
            window.location.href = '/debug.html';
        }

        function showLoginPage() {
            trackAction('Show_Login_Page');
            window.location.href = '/login.html';
        }

        function logout() {
            trackAction('Logout');
            if (confirm('üö™ Logout and return to login page?')) {
                // Clear session
                document.cookie = 'pokemon_session=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
                localStorage.removeItem('pokemon_user');
                sessionStorage.clear();
                
                // Redirect to login
                window.location.href = '/login.html';
            }
        }

        function clearAllData() {
            trackAction('Clear_All_Data');
            if (confirm('üö® This will clear all your game data and logout.\n\nAre you sure?')) {
                // Clear everything
                document.cookie = 'pokemon_session=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
                localStorage.clear();
                sessionStorage.clear();
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                alert('‚úÖ All data cleared!');
                window.location.href = '/login.html';
            }
        }

        // System Status
        function updateSystemStatus() {
            const ua = navigator.userAgent;
            const isMobile = /iPhone|iPad|iPod|Android/i.test(ua);
            const isIOS = /iPhone|iPad|iPod/i.test(ua);
            const isSafari = /Safari/i.test(ua) && !/Chrome/i.test(ua);
            const isChrome = /Chrome/i.test(ua);

            document.getElementById('systemStatus').innerHTML = `
                <div>üì± Device: ${isMobile ? 'Mobile' : 'Desktop'} | ${isIOS ? 'iOS' : 'Other'}</div>
                <div>üåê Browser: ${isChrome ? 'Chrome' : isSafari ? 'Safari' : 'Other'}</div>
                <div>üïí Last Updated: ${new Date().toLocaleTimeString()}</div>
                <div>‚úÖ HTML Version: Fully Functional</div>
                <div>üîê Auth: ${isAuthenticated ? 'Social Login ‚úÖ' : 'Guest Mode üë§'}</div>
                ${isAuthenticated ? `<div>üë§ User: ${currentUser?.email}</div>` : ''}
            `;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            updateSystemStatus();
            setInterval(updateSystemStatus, 30000); // Update every 30 seconds
        });
    </script>
</body>
</html>
