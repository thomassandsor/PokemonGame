<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Game - Mobile Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .qr-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px 5px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(255,107,107,0.3);
        }
        .button:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }
        .status {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
        }
        .device-info {
            background: rgba(0,0,0,0.2);
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            font-size: 14px;
        }
        .emergency {
            background: #ff9800;
            color: white;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid #f57c00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Pokemon Game</h1>
        <h2>üì± Mobile Testing</h2>
        
        <div class="qr-container">
            <div id="qrcode"></div>
            <p style="color: #333; margin: 10px 0;"><strong>Scan with mobile device</strong></p>
        </div>
        
        <p><strong>Production URL:</strong><br>
        <a href="https://red-forest-0b2b6ae03.1.azurestaticapps.net?mobile-test=true" 
           style="color: #ffd54f; word-break: break-all;">
           https://red-forest-0b2b6ae03.1.azurestaticapps.net?mobile-test=true
        </a></p>
        
        <div class="device-info">
            <strong>Your Device:</strong><br>
            <span id="deviceInfo">Loading...</span>
        </div>
        
        <div>
            <a href="https://red-forest-0b2b6ae03.1.azurestaticapps.net?mobile-test=true" class="button">
                üöÄ Test Normal Login
            </a>
            <a href="https://red-forest-0b2b6ae03.1.azurestaticapps.net?mobile-test=true&debug=true" class="button">
                üîß Test with Debug Panel
            </a>
        </div>
        
        <div class="emergency">
            <h3>üÜò Emergency Access (if stuck)</h3>
            <a href="https://red-forest-0b2b6ae03.1.azurestaticapps.net?emergency=debug" class="button">
                Emergency Debug
            </a>
            <a href="https://red-forest-0b2b6ae03.1.azurestaticapps.net?emergency=clear" class="button">
                Clear Auth
            </a>
        </div>
        
        <div>
            <button class="button" onclick="testAppInsights()">üìä Test Telemetry</button>
            <button class="button" onclick="simulateMobileIssue()">‚ö†Ô∏è Simulate Mobile Issue</button>
        </div>
        
        <div class="status" id="status">
            <div class="info">üìã Mobile Testing Instructions:</div>
            <div>1. Scan QR code or click links on mobile device</div>
            <div>2. Try to log in with Microsoft account</div>
            <div>3. Report any white screen or stuck states</div>
            <div>4. Test emergency access if needed</div>
            <div>5. Check Application Insights for mobile data</div>
        </div>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <!-- Application Insights for this test page -->
    <script type="text/javascript">
        !function(T,l,y){var S=T.location,k="script",D="instrumentationKey",C="ingestionendpoint",I="disableExceptionTracking",E="ai.device.",b="toLowerCase",w="crossOrigin",N="POST",e="appInsightsSDK",t=y.name||"appInsights";(y.name||T[e])&&(T[e]=t);var n=T[t]||function(d){var g=!1,f=!1,m={initialize:!0,queue:[],sv:"5",version:2,config:d};function v(e,t){var n={},a="Browser";return n[E+"id"]=a[b](),n[E+"type"]=a,n["ai.operation.name"]=S&&S.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(m.sv||m.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}(),iKey:e,name:"Microsoft.ApplicationInsights."+t.replace(/-/g,"")+"."+n["ai.operation.name"].replace(/\s/g,""),sampleRate:100,tags:n,data:{baseData:{ver:2}}}}var h=d.url||y.src;if(h){function a(e){var t,n,a,i,r,o,s,c,u,p,l;g=!0,m.queue=[],f||(f=!0,t=h,s=function(){var e={},t=d.connectionString;if(t)for(var n=t.split(";"),a=0;a<n.length;a++){var i=n[a].split("=");2===i.length&&(e[i[0][b]()]=i[1])}if(!e[C]){var r=e.endpointsuffix,o=r?e.location:null;e[C]="https://"+(o?o+".":"")+"dc."+(r||"services.visualstudio.com")}return e}(),c=s[D]||d[D]||"",u=s[C],p=u?u+"/v2/track":d.endpointUrl,(l=[]).push((n="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",a=t,i=p,(o=(r=v(c,"Exception")).data).baseType="ExceptionData",o.baseData.exceptions=[{typeName:"SDKLoadFailed",message:n.replace(/\./g,"-"),hasFullStack:!1,stack:n+"\nSnippet failed to load ["+a+"] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: "+(S&&S.pathname||"_unknown_")+"\nEndpoint: "+i,parsedStack:[]}],r)),l.push(function(e,t,n,a){var i=v(c,"Message"),r=i.data;r.baseType="MessageData";var o=r.baseData;return o.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+t+")").replace(/\"/g,"")+'"',o.properties={endpoint:a},i}(0,t,0,p)),function(e,t){if(JSON){var n=T.fetch;if(n&&!y.useXhr)n(t,{method:N,body:JSON.stringify(e),mode:"cors"});else if(XMLHttpRequest){var a=new XMLHttpRequest;a.open(N,t),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(e))}}}(l,p))}function i(e,t){f||setTimeout(function(){!t&&m.core||a()},500)}var e=function(){var n=l.createElement(k);n.src=h;var e=y[w];return!e&&""!==e||"undefined"==n[w]||(n[w]=e),n.onload=i,n.onerror=a,n.onreadystatechange=function(e,t){"loaded"!==n.readyState&&"complete"!==n.readyState||i(0,t)},n}();y.ld<0?l.getElementsByTagName("head")[0].appendChild(e):setTimeout(function(){l.getElementsByTagName(k)[0].parentNode.insertBefore(e,l.getElementsByTagName(k)[0])},y.ld||0)}try{m.cookie=l.cookie}catch(p){}function t(e){for(;e.length;)!function(t){m[t]=function(){var e=arguments;g||m.queue.push(function(){m[t].apply(m,e)})}}(e.pop())}var n="track",r="TrackPage",o="TrackEvent";t([n+"Event",n+"PageView",n+"Exception",n+"Trace",n+"DependencyData",n+"Metric",n+"PageViewPerformance","start"+r,"stop"+r,"start"+o,"stop"+o,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),m.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4};var s=(d.extensionConfig||{}).ApplicationInsightsAnalytics||{};if(!0!==d[I]&&!0!==s[I]){var c="onerror";t(["_"+c]);var u=T[c];T[c]=function(e,t,n,a,i){var r=u&&u(e,t,n,a,i);return!0!==r&&m["_"+c]({message:e,url:t,lineNumber:n,columnNumber:a,error:i}),r},d.autoExceptionInstrumented=!0}return m}(y.cfg);function a(){y.onInit&&y.onInit(n)}(T[t]=n).queue&&0===n.queue.length?(n.queue.push(a),n.trackPageView({})):a()}(window,document,{
            src: "https://js.monitor.azure.com/scripts/b/ai.2.min.js",
            cfg: {
                connectionString: "InstrumentationKey=a5e49ae4-0936-46c2-a6b6-b237830466dd;IngestionEndpoint=https://westeurope-5.in.applicationinsights.azure.com/;LiveEndpoint=https://westeurope.livediagnostics.monitor.azure.com/;ApplicationId=29d06d0b-7c8b-4cae-9e84-dc9cc00bec96",
                enableAutoRouteTracking: true,
                enableDebug: true,
                samplingPercentage: 100
            }
        });
    </script>

    <script>
        const statusDiv = document.getElementById('status');
        const deviceInfoDiv = document.getElementById('deviceInfo');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            statusDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }

        function detectDevice() {
            const ua = navigator.userAgent;
            const isMobile = /iPhone|iPad|iPod|Android/i.test(ua);
            const isIOS = /iPhone|iPad|iPod/i.test(ua);
            const isAndroid = /Android/i.test(ua);
            const isSafari = /Safari/i.test(ua) && !/Chrome/i.test(ua);
            
            return {
                isMobile,
                isIOS,
                isAndroid,
                isSafari,
                platform: navigator.platform,
                userAgent: ua,
                screen: `${screen.width}x${screen.height}`,
                viewport: `${window.innerWidth}x${window.innerHeight}`
            };
        }

        function testAppInsights() {
            const device = detectDevice();
            
            appInsights.trackEvent({ 
                name: 'Mobile_Test_Page_Telemetry_Test',
                properties: {
                    ...device,
                    testType: 'Manual Telemetry Test',
                    timestamp: new Date().toISOString(),
                    source: 'Mobile Test Page'
                }
            });
            
            log('üìä Telemetry test sent to Application Insights', 'success');
            log(`Device: ${device.isMobile ? 'Mobile' : 'Desktop'} | ${device.isIOS ? 'iOS' : device.isAndroid ? 'Android' : 'Other'}`, 'info');
        }

        function simulateMobileIssue() {
            const device = detectDevice();
            
            // Simulate authentication issue
            appInsights.trackEvent({ 
                name: 'Mobile_Authentication_Issue_Simulation',
                properties: {
                    ...device,
                    issue: 'simulated_white_screen',
                    testType: 'Mobile Issue Simulation',
                    timestamp: new Date().toISOString(),
                    source: 'Mobile Test Page'
                }
            });
            
            // Simulate exception
            const simulatedError = new Error('Simulated mobile authentication failure');
            appInsights.trackException({ 
                exception: simulatedError,
                properties: {
                    ...device,
                    testType: 'Mobile Issue Simulation',
                    source: 'Mobile Test Page'
                }
            });
            
            log('‚ö†Ô∏è Simulated mobile authentication issue sent to Application Insights', 'error');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            const device = detectDevice();
            
            // Display device info
            deviceInfoDiv.innerHTML = `
                ${device.isMobile ? 'üì± Mobile' : 'üíª Desktop'} | 
                ${device.isIOS ? 'iOS' : device.isAndroid ? 'Android' : navigator.platform} | 
                ${device.screen}
            `;
            
            // Generate QR code
            const testUrl = 'https://red-forest-0b2b6ae03.1.azurestaticapps.net?mobile-test=true';
            QRCode.toCanvas(document.getElementById('qrcode'), testUrl, function (error) {
                if (error) {
                    log('‚ùå QR code generation failed', 'error');
                } else {
                    log('‚úÖ QR code generated successfully', 'success');
                }
            });
            
            // Send initial telemetry
            appInsights.trackEvent({ 
                name: 'Mobile_Test_Page_Loaded',
                properties: {
                    ...device,
                    testType: 'Test Page Load',
                    timestamp: new Date().toISOString(),
                    source: 'Mobile Test Page'
                }
            });
            
            log('üéÆ Pokemon Game Mobile Test Page loaded', 'success');
            log(`Device detected: ${device.isMobile ? 'Mobile' : 'Desktop'}`, 'info');
            
            if (device.isMobile) {
                log('üì± Mobile device detected! This page can be used for testing.', 'success');
            } else {
                log('üíª Desktop detected. Scan QR code with mobile device to test.', 'info');
            }
        });
    </script>
</body>
</html>
