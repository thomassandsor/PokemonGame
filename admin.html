<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Game - Admin Panel</title>
    <link rel="stylesheet" href="styles/pokemon-design-system.css">
</head>
<body class="pokemon-game-body">
    <div class="pokemon-container">
        <!-- Clean Header -->
        <header class="pokemon-header">
            <div class="pokemon-header-content">
                <h1 class="pokemon-title">üîß Admin Panel</h1>
                <p class="pokemon-subtitle">Manage your Pokemon game system</p>
                <a href="index.html" class="pokemon-btn pokemon-btn-sm">‚Üê Back to Game</a>
            </div>
        </header>

        <!-- Admin Navigation Tabs -->
        <nav class="pokemon-admin-nav">
            <button class="pokemon-tab-btn active" onclick="showTab('pokemon')" id="tab-pokemon">
                üêæ Pokemon Management
            </button>
            <button class="pokemon-tab-btn" onclick="showTab('users')" id="tab-users">
                üë• User Management
            </button>
            <button class="pokemon-tab-btn" onclick="showTab('system')" id="tab-system">
                ‚öôÔ∏è System Settings
            </button>
            <button class="pokemon-tab-btn" onclick="showTab('settings')" id="tab-settings">
                üîß Portal Settings
            </button>
        </nav>

        <!-- Pokemon Management Tab -->
        <div id="pokemon-tab" class="pokemon-admin-section">
            <h2 class="pokemon-section-title">üêæ Pokemon Data Management</h2>
            
            <div class="pokemon-admin-grid">
                <div class="pokemon-admin-card">
                    <div class="admin-card-icon">üì•</div>
                    <h3>Quick Import Popular Pokemon</h3>
                    <p>Import the most popular Pokemon from PokeAPI</p>
                    <div class="pokemon-input-group">
                        <label for="pokemonCount">Number of Pokemon:</label>
                        <input type="range" id="pokemonCount" min="1" max="150" value="20" class="pokemon-range">
                        <span id="pokemonCountValue" class="pokemon-range-value">20</span>
                    </div>
                    <button class="pokemon-btn pokemon-btn-primary" onclick="handleQuickImport()" id="quickImportBtn">
                        üì• Import 20 Pokemon
                    </button>
                </div>

                <div class="pokemon-admin-card">
                    <div class="admin-card-icon">üéØ</div>
                    <h3>Custom Pokemon Import</h3>
                    <p>Import specific Pokemon by their IDs</p>
                    <div class="pokemon-input-group">
                        <input type="text" id="customPokemonIds" class="pokemon-input" placeholder="e.g., 1,4,7,25,133">
                    </div>
                    <button class="pokemon-btn pokemon-btn-primary" onclick="handleCustomImport()" id="customImportBtn">
                        üì• Import Custom
                    </button>
                </div>

                <div class="pokemon-admin-card">
                    <div class="admin-card-icon">üîå</div>
                    <h3>Test Dataverse Connection</h3>
                    <p>Verify connection to Microsoft Dataverse</p>
                    <button class="pokemon-btn pokemon-btn-secondary" onclick="testDataverseConnection()">
                        üîç Test Connection
                    </button>
                </div>
            </div>

            <!-- Import Results -->
            <div id="importResults" class="pokemon-admin-results hidden">
                <h3>üìä Import Results</h3>
                <div class="pokemon-results-stats">
                    <div class="stat-success">
                        <span>‚úÖ Imported:</span>
                        <span id="importedCount">0</span>
                    </div>
                    <div class="stat-error">
                        <span>‚ùå Failed:</span>
                        <span id="failedCount">0</span>
                    </div>
                </div>
                <div id="importErrors" class="pokemon-error-details hidden">
                    <h4>‚ö†Ô∏è Errors:</h4>
                    <ul id="errorList"></ul>
                </div>
            </div>
        </div>

        <!-- User Management Tab -->
        <div id="users-tab" class="pokemon-admin-section hidden">
            <h2 class="pokemon-section-title">üë• User Management</h2>
            
            <div class="pokemon-admin-grid">
                <div class="pokemon-admin-card">
                    <div class="admin-card-icon">üìä</div>
                    <h3>User Statistics</h3>
                    <p>View user registration and activity stats</p>
                    <button class="pokemon-btn pokemon-btn-primary" onclick="viewUserStats()">
                        üìà View Stats
                    </button>
                </div>

                <div class="pokemon-admin-card">
                    <div class="admin-card-icon">üîç</div>
                    <h3>User Search</h3>
                    <p>Search and manage user accounts</p>
                    <div class="pokemon-input-group">
                        <input type="text" id="userSearch" class="pokemon-input" placeholder="Search by email or name">
                    </div>
                    <button class="pokemon-btn pokemon-btn-primary" onclick="searchUsers()">
                        üîç Search Users
                    </button>
                </div>

                <div class="pokemon-admin-card">
                    <div class="admin-card-icon">üèÜ</div>
                    <h3>Leaderboards</h3>
                    <p>Manage Pokemon collection leaderboards</p>
                    <button class="pokemon-btn pokemon-btn-primary" onclick="manageLeaderboards()">
                        üèÜ Manage Leaderboards
                    </button>
                </div>
            </div>
        </div>

        <!-- System Settings Tab -->
        <div id="system-tab" class="pokemon-admin-section hidden">
            <h2 class="pokemon-section-title">‚öôÔ∏è System Settings</h2>
            
            <div class="pokemon-admin-grid">
                <div class="pokemon-admin-card">
                    <div class="admin-card-icon">üì•</div>
                    <h3>Portal Settings Import</h3>
                    <p>Import default portal settings from JSON configuration</p>
                    <button class="pokemon-btn pokemon-btn-primary" onclick="importPortalSettings()" id="settingsImportBtn">
                        üì• Import Portal Settings
                    </button>
                    <div id="settingsImportResult" class="pokemon-import-result hidden"></div>
                </div>

                <div class="pokemon-admin-card">
                    <div class="admin-card-icon">üé≠</div>
                    <h3>Demo Mode</h3>
                    <p>Enable testing mode to bypass authentication</p>
                    <div class="pokemon-demo-info">
                        <p><strong>Status:</strong> <span id="demoStatus">‚ùå Disabled</span></p>
                        <p><strong>Storage:</strong> Dataverse (pokemon_portalsetting)</p>
                    </div>
                    <button class="pokemon-btn pokemon-btn-secondary" onclick="toggleDemoMode()" id="demoModeBtn">
                        üé≠ Enable Demo Mode
                    </button>
                    <div class="pokemon-demo-help">
                        <p><small>üí° <strong>URL Bypass:</strong> Add <code>?demo=true</code> or <code>?bypass=true</code> to any URL</small></p>
                        <p><small>‚öôÔ∏è Setting affects all users globally</small></p>
                    </div>
                </div>

                <div class="pokemon-admin-card">
                    <div class="admin-card-icon">üóÉÔ∏è</div>
                    <h3>Database Management</h3>
                    <p>Backup and maintenance operations</p>
                    <button class="pokemon-btn pokemon-btn-secondary" onclick="testDataverseConnection()">
                        üîó Test Dataverse Connection
                    </button>
                </div>
            </div>
        </div>

        <!-- Portal Settings Tab -->
        <div id="settings-tab" class="pokemon-admin-section hidden">
            <h2 class="pokemon-section-title">üîß Portal Settings Management</h2>
            
            <div class="pokemon-settings-container">
                <div class="pokemon-settings-header">
                    <button class="pokemon-btn pokemon-btn-primary" onclick="loadAllSettings()">
                        üîÑ Refresh Settings
                    </button>
                    <button class="pokemon-btn pokemon-btn-secondary" onclick="addNewSetting()">
                        ‚ûï Add New Setting
                    </button>
                </div>

                <div id="settingsLoading" class="pokemon-loading hidden">
                    <p>üîÑ Loading portal settings...</p>
                </div>

                <div id="settingsList" class="pokemon-settings-list">
                    <!-- Settings will be loaded dynamically -->
                </div>

                <!-- Add New Setting Form -->
                <div id="addSettingForm" class="pokemon-setting-form hidden">
                    <h3>‚ûï Add New Portal Setting</h3>
                    <div class="pokemon-input-group">
                        <label for="newSettingKey">Setting Key:</label>
                        <input type="text" id="newSettingKey" class="pokemon-input" placeholder="e.g., battle_turns">
                    </div>
                    <div class="pokemon-input-group">
                        <label for="newSettingValue">Setting Value:</label>
                        <input type="text" id="newSettingValue" class="pokemon-input" placeholder="e.g., 50">
                    </div>
                    <div class="pokemon-input-group">
                        <label for="newSettingDescription">Description:</label>
                        <input type="text" id="newSettingDescription" class="pokemon-input" placeholder="e.g., Maximum battle turns">
                    </div>
                    <div class="pokemon-form-actions">
                        <button class="pokemon-btn pokemon-btn-primary" onclick="saveNewSetting()">
                            üíæ Save Setting
                        </button>
                        <button class="pokemon-btn pokemon-btn-secondary" onclick="cancelAddSetting()">
                            ‚ùå Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="statusMessage" class="pokemon-status-message hidden">
            <p id="statusText"></p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="auth.js"></script>
    <script src="portal-settings-service.js"></script>
    <script src="pokemon-service.js"></script>
    <script src="admin-panel.js"></script>

    <style>
        /* Admin Panel Specific Styles */
        .pokemon-admin-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 2rem 0;
            padding: 0 1rem;
            border-bottom: 2px solid var(--pokemon-blue);
        }

        .pokemon-tab-btn {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--pokemon-gray);
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
        }

        .pokemon-tab-btn:hover {
            background: var(--pokemon-light-blue);
            color: var(--pokemon-blue);
        }

        .pokemon-tab-btn.active {
            background: var(--pokemon-blue);
            color: white;
        }

        .pokemon-admin-section {
            padding: 2rem 1rem;
        }

        .pokemon-section-title {
            color: var(--pokemon-blue);
            margin-bottom: 2rem;
            text-align: center;
        }

        .pokemon-admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .pokemon-admin-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid var(--pokemon-light-blue);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .pokemon-admin-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .admin-card-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .pokemon-admin-card h3 {
            color: var(--pokemon-blue);
            margin-bottom: 1rem;
        }

        .pokemon-admin-card p {
            color: var(--pokemon-gray);
            margin-bottom: 1.5rem;
        }

        .pokemon-range {
            width: 100%;
            margin: 0.5rem 0;
        }

        .pokemon-range-value {
            display: inline-block;
            min-width: 3rem;
            text-align: center;
            font-weight: bold;
            color: var(--pokemon-blue);
        }

        .pokemon-admin-results {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid var(--pokemon-green);
        }

        .pokemon-results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-success, .stat-error {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-radius: 8px;
            font-weight: bold;
        }

        .stat-success {
            background: var(--pokemon-light-green);
            color: var(--pokemon-green);
        }

        .stat-error {
            background: var(--pokemon-light-red);
            color: var(--pokemon-red);
        }

        .pokemon-error-details {
            background: var(--pokemon-light-red);
            border: 2px solid var(--pokemon-red);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .pokemon-error-details h4 {
            color: var(--pokemon-red);
            margin-bottom: 0.5rem;
        }

        .pokemon-demo-info p {
            margin: 0.5rem 0;
        }

        .pokemon-demo-help {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--pokemon-light-gray);
        }

        .pokemon-demo-help p {
            margin: 0.25rem 0;
        }

        .pokemon-settings-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .pokemon-settings-header {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .pokemon-settings-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .pokemon-setting-item {
            background: white;
            border: 2px solid var(--pokemon-light-blue);
            border-radius: 12px;
            padding: 1.5rem;
            display: grid;
            grid-template-columns: 1fr 200px 120px;
            gap: 1rem;
            align-items: center;
        }

        .pokemon-setting-form {
            background: white;
            border: 2px solid var(--pokemon-green);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .pokemon-form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .pokemon-status-message {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--pokemon-green);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .pokemon-status-message.error {
            background: var(--pokemon-red);
        }

        .pokemon-loading {
            text-align: center;
            padding: 2rem;
            color: var(--pokemon-gray);
        }

        .hidden {
            display: none !important;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .pokemon-admin-grid {
                grid-template-columns: 1fr;
            }
            
            .pokemon-admin-nav {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .pokemon-tab-btn {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .pokemon-setting-item {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .pokemon-settings-header {
                flex-direction: column;
            }
        }
    </style>
</body>
</html>
