<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Cards Testing - Pokemon Game</title>
    <link rel="stylesheet" href="styles/pokemon-design-system.css">
    <style>
        /* Testing page specific styles using design system */
        .cards-testing-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .cards-testing-header {
            text-align: center;
            margin-bottom: var(--space-xl);
            color: var(--white);
        }

        .cards-testing-header h1 {
            font-size: 2.5rem;
            margin-bottom: var(--space-md);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .cards-testing-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: var(--space-lg);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .card-demo-section {
            background: var(--white);
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: var(--space-md);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .card-demo-header {
            text-align: center;
            padding: var(--space-sm);
            margin-bottom: var(--space-md);
            background: var(--gradient-yellow-blue);
            border-radius: var(--radius-sm);
            color: var(--white);
        }

        .card-demo-title {
            font-size: 14px;
            font-weight: 600;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
        }

        .card-demo-description {
            font-size: 11px;
            opacity: 0.9;
            margin: var(--space-xs) 0 0 0;
        }

        /* Embedded Pokemon Cards */
        .embedded-pokemon-card {
            transform: scale(0.8);
            transform-origin: top center;
            margin: -20px -40px -40px -40px;
        }

        .variable-info {
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-top: var(--space-xl);
            border: 2px solid #2d3436;
        }

        .variable-info h3 {
            color: #2d3436;
            margin-bottom: var(--space-md);
            font-size: 1.2rem;
        }

        .variable-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-md);
        }

        .variable-item {
            background: #f8f9fa;
            padding: var(--space-sm);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--pokemon-blue);
        }

        .variable-name {
            font-weight: bold;
            color: #2d3436;
            font-family: 'Courier New', monospace;
        }

        .variable-desc {
            font-size: 0.9rem;
            color: #636e72;
            margin-top: 4px;
        }

        .admin-note {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid var(--pokemon-yellow);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-top: var(--space-lg);
            color: var(--white);
            text-align: center;
        }
    </style>
</head>
<body class="pokemon-game-body">
    <div class="pokemon-container-wide cards-testing-container">
        <!-- Header -->
        <header class="pokemon-header">
            <div class="pokemon-header-content cards-testing-header">
                <h1 class="pokemon-title">üÉè Pokemon Cards Testing Lab</h1>
                <p class="pokemon-text">Test all Pokemon card contexts with Bulbasaur (#001) and dummy training data</p>
                <button class="pokemon-btn pokemon-btn-secondary" onclick="goHome()">
                    ‚Üê Back to Main Menu
                </button>
            </div>
        </header>

        <!-- Cards Grid -->
        <div class="pokemon-grid cards-grid">
            <!-- Browse All Pokemon Card -->
            <div class="card-demo-section">
                <div class="card-demo-header">
                    <h3 class="card-demo-title">üìñ Browse All Pokemon</h3>
                    <p class="card-demo-description">Shows Bulbasaur as if viewing from complete Pokedex</p>
                </div>
                <div id="browseCardContainer" class="embedded-pokemon-card"></div>
            </div>

            <!-- My Collection Card -->
            <div class="card-demo-section">
                <div class="card-demo-header">
                    <h3 class="card-demo-title">üéØ My Pokemon Collection</h3>
                    <p class="card-demo-description">Shows caught Bulbasaur with training stats</p>
                </div>
                <div id="myPokemonCardContainer" class="embedded-pokemon-card"></div>
            </div>

            <!-- Wild Encounter Card -->
            <div class="card-demo-section">
                <div class="card-demo-header">
                    <h3 class="card-demo-title">üåø Wild Encounter</h3>
                    <p class="card-demo-description">Shows wild Pokemon encounter with pokeballs</p>
                </div>
                <div id="encounterCardContainer" class="embedded-pokemon-card"></div>
            </div>

            <!-- Battle Card -->
            <div class="card-demo-section">
                <div class="card-demo-header">
                    <h3 class="card-demo-title">‚öîÔ∏è Battle Pokemon</h3>
                    <p class="card-demo-description">Shows battle context with HP and moves</p>
                </div>
                <div id="battleCardContainer" class="embedded-pokemon-card"></div>
            </div>

            <!-- No Pokeballs Encounter -->
            <div class="card-demo-section">
                <div class="card-demo-header">
                    <h3 class="card-demo-title">üî¥ No Pokeballs Encounter</h3>
                    <p class="card-demo-description">Shows encounter with no pokeballs available</p>
                </div>
                <div id="noPokebballsCardContainer" class="embedded-pokemon-card"></div>
            </div>

            <!-- Comparison Card -->
            <div class="card-demo-section">
                <div class="card-demo-header">
                    <h3 class="card-demo-title">üìä Comparison View</h3>
                    <p class="card-demo-description">Clean stats view for comparison</p>
                </div>
                <div id="comparisonCardContainer" class="embedded-pokemon-card"></div>
            </div>
        </div>

        <!-- Variable Information -->
        <section class="pokemon-section variable-info">
            <h3 class="pokemon-subtitle">üîß Training Variables (for My Pokemon context)</h3>
            <div class="variable-list">
                <div class="variable-item">
                    <div class="variable-name">pokemon.level</div>
                    <div class="variable-desc">Current Pokemon level (1-100)</div>
                </div>
                <div class="variable-item">
                    <div class="variable-name">pokemon.experience</div>
                    <div class="variable-desc">Total experience points earned</div>
                </div>
                <div class="variable-item">
                    <div class="variable-name">pokemon.trainedAttack</div>
                    <div class="variable-desc">Base attack + training bonuses</div>
                </div>
                <div class="variable-item">
                    <div class="variable-name">pokemon.trainedDefense</div>
                    <div class="variable-desc">Base defense + training bonuses</div>
                </div>
                <div class="variable-item">
                    <div class="variable-name">pokemon.trainedHP</div>
                    <div class="variable-desc">Base HP + training bonuses</div>
                </div>
                <div class="variable-item">
                    <div class="variable-name">pokemon.nickname</div>
                    <div class="variable-desc">Custom nickname given by trainer</div>
                </div>
                <div class="variable-item">
                    <div class="variable-name">pokemon.dateCaught</div>
                    <div class="variable-desc">When Pokemon was caught</div>
                </div>
                <div class="variable-item">
                    <div class="variable-name">pokemon.isShiny</div>
                    <div class="variable-desc">Whether Pokemon is shiny variant</div>
                </div>
                <div class="variable-item">
                    <div class="variable-name">pokemon.wins</div>
                    <div class="variable-desc">Number of battles won</div>
                </div>
                <div class="variable-item">
                    <div class="variable-name">pokemon.losses</div>
                    <div class="variable-desc">Number of battles lost</div>
                </div>
                <div class="variable-item">
                    <div class="variable-name">pokemon.currentHP</div>
                    <div class="variable-desc">Current HP (for battle context)</div>
                </div>
                <div class="variable-item">
                    <div class="variable-name">pokemon.statusEffect</div>
                    <div class="variable-desc">Current status (poisoned, paralyzed, etc.)</div>
                </div>
            </div>
        </section>

        <!-- Admin Note -->
        <section class="pokemon-section admin-note">
            <strong>üìã Future Admin Integration</strong><br>
            <span class="pokemon-text-small">This testing page will later be moved to an admin section accessible only to developers.
            Real Pokemon data and training systems will replace these dummy variables.</span>
        </section>
    </div>

    <!-- Include the card system -->
    <script src="components/pokemon-card-system.js"></script>
    
    <script>
        // Initialize card system
        let pokemonCards;

        document.addEventListener('DOMContentLoaded', function() {
            pokemonCards = new PokemonCardSystem();
            
            // Create all embedded cards
            createEmbeddedCards();
        });

        function createEmbeddedCards() {
            // Create Browse All Pokemon Card
            createEmbeddedCard('browseCardContainer', bulbasaurData, 'BROWSE_ALL', {
                callbacks: { close: () => console.log('Browse card action') }
            });

            // Create My Collection Card
            createEmbeddedCard('myPokemonCardContainer', bulbasaurData, 'MY_COLLECTION', {
                caughtPokemon: caughtBulbasaurData,
                callbacks: {
                    close: () => console.log('My Pokemon action'),
                    rename: (pokemon) => console.log('Rename:', pokemon.nickname || pokemon.name),
                    release: (pokemon) => console.log('Release:', pokemon.nickname || pokemon.name)
                }
            });

            // Create Wild Encounter Card
            createEmbeddedCard('encounterCardContainer', bulbasaurData, 'ENCOUNTER', {
                pokeballCount: 5,
                callbacks: {
                    catch: () => console.log('Catch action'),
                    runAway: () => console.log('Run away action')
                }
            });

            // Create Battle Card
            createEmbeddedCard('battleCardContainer', bulbasaurData, 'BATTLE', {
                caughtPokemon: shinyCaughtBulbasaurData,
                battleStats: {
                    currentHP: shinyCaughtBulbasaurData.currentHP,
                    maxHP: shinyCaughtBulbasaurData.hp,
                    statusEffect: shinyCaughtBulbasaurData.statusEffect
                },
                moves: ['Vine Whip', 'Tackle', 'Growl', 'Leech Seed'],
                callbacks: {
                    selectMove: (pokemon, move) => console.log(`${pokemon.nickname || pokemon.name} used ${move}!`),
                    switchPokemon: () => console.log('Switch Pokemon')
                }
            });

            // Create No Pokeballs Card
            createEmbeddedCard('noPokebballsCardContainer', bulbasaurData, 'ENCOUNTER', {
                pokeballCount: 0,
                callbacks: {
                    catch: () => console.log('No pokeballs!'),
                    runAway: () => console.log('Run away - no pokeballs!')
                }
            });

            // Create Comparison Card
            createEmbeddedCard('comparisonCardContainer', bulbasaurData, 'COMPARISON', {
                callbacks: { close: () => console.log('Comparison action') }
            });
        }

        function createEmbeddedCard(containerId, pokemonData, contextId, options) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const context = PokemonCardSystem.CONTEXTS[contextId];
            if (!context) return;

            // Create the card HTML structure
            const cardHTML = `
                <div class="pokemon-trading-card">
                    <!-- Header Section -->
                    <div id="${containerId}_header" class="pokemon-trading-card-header normal">
                        <div class="pokemon-trading-card-name" id="${containerId}_name">Pokemon Name</div>
                    </div>
                    
                    <!-- Image Section -->
                    <div class="pokemon-trading-card-image-container">
                        <img id="${containerId}_image" class="pokemon-trading-card-image" src="" alt="Pokemon">
                        <!-- Type badges overlaid on image -->
                        <div id="${containerId}_types" class="pokemon-trading-card-types-overlay">
                            <!-- Type badges populated dynamically -->
                        </div>
                        <!-- ID overlaid on image -->
                        <div id="${containerId}_id" class="pokemon-trading-card-id-overlay">
                            <!-- ID populated dynamically -->
                        </div>
                    </div>
                    
                    <!-- Stats Section -->
                    <div id="${containerId}_stats" class="pokemon-trading-card-stats">
                        <!-- Stats populated dynamically -->
                    </div>
                    
                    <!-- Dynamic Content Sections -->
                    <div id="${containerId}_content" style="padding: 0 var(--space-md) var(--space-md);">
                        <!-- Context-specific content goes here -->
                    </div>
                    
                    <!-- Action Buttons Section -->
                    <div id="${containerId}_actions" class="pokemon-trading-card-actions">
                        <!-- Action buttons populated dynamically -->
                    </div>
                </div>
            `;

            container.innerHTML = cardHTML;

            // Use a modified card system to populate this embedded card
            populateEmbeddedCard(containerId, pokemonData, context, options);
        }

        function populateEmbeddedCard(containerId, pokemonData, context, options) {
            // Set basic Pokemon info
            const nameElement = document.getElementById(`${containerId}_name`);
            const imageElement = document.getElementById(`${containerId}_image`);

            nameElement.textContent = pokemonCards.formatPokemonName(pokemonData.name);
            imageElement.src = pokemonCards.getPokemonImageUrl(pokemonData);
            imageElement.alt = pokemonData.name;

            // Set type-based styling
            const headerElement = document.getElementById(`${containerId}_header`);
            const typesContainer = document.getElementById(`${containerId}_types`);
            
            const types = pokemonCards.getPokemonTypes(pokemonData);
            const primaryType = types[0] || 'normal';
            
            headerElement.className = `pokemon-trading-card-header ${primaryType.toLowerCase()}`;
            
            // Populate type badges with overlay styling
            typesContainer.innerHTML = '';
            types.forEach(type => {
                const badge = pokemonCards.createTypeBadge(type);
                badge.classList.add('overlay-badge');
                typesContainer.appendChild(badge);
            });

            // Populate ID overlay
            const idContainer = document.getElementById(`${containerId}_id`);
            idContainer.innerHTML = '';
            if (pokemonData.id || pokemonData.nationalDexNumber) {
                const idBadge = document.createElement('span');
                idBadge.className = 'overlay-badge id-badge';
                idBadge.textContent = `#${pokemonData.id || pokemonData.nationalDexNumber}`;
                idContainer.appendChild(idBadge);
            }

            // Populate stats (HP, Attack, Defense only)
            const statsContainer = document.getElementById(`${containerId}_stats`);
            statsContainer.innerHTML = '';
            const stats = pokemonCards.getPokemonStats(pokemonData, options);
            
            // Filter to only show HP, Attack, Defense
            const filteredStats = [
                stats.find(s => s.name === 'Attack') || { name: 'Attack', value: pokemonData.baseAttack || 50 },
                stats.find(s => s.name === 'Defense') || { name: 'Defense', value: pokemonData.baseDefence || 50 },
                { name: 'HP', value: options.caughtPokemon?.hp || pokemonData.baseHp || pokemonCards.calculateHP(pokemonData) }
            ];
            
            filteredStats.forEach(stat => {
                const statRow = document.createElement('div');
                statRow.className = 'pokemon-trading-card-stats-row';
                statRow.innerHTML = `
                    <span class="pokemon-trading-card-stat-name">${stat.name}</span>
                    <span class="pokemon-trading-card-stat-value">${stat.value}</span>
                `;
                statsContainer.appendChild(statRow);
            });

            // Build sections
            const dynamicContent = document.getElementById(`${containerId}_content`);
            dynamicContent.innerHTML = '';

            context.sections.forEach(sectionType => {
                if (sectionType === 'types' || sectionType === 'stats') return; // Already handled above
                
                const section = createEmbeddedSection(sectionType, pokemonData, options, containerId);
                if (section) {
                    dynamicContent.appendChild(section);
                }
            });

            // Build action buttons
            const actionsContainer = document.getElementById(`${containerId}_actions`);
            actionsContainer.innerHTML = '';

            context.actions.forEach(actionType => {
                const button = createEmbeddedActionButton(actionType, options, containerId);
                if (button) {
                    actionsContainer.appendChild(button);
                }
            });
        }

        function createEmbeddedSection(sectionType, pokemonData, options, containerId) {
            // Use similar logic to the main card system but for embedded cards
            switch(sectionType) {
                case 'basic':
                    return createEmbeddedBasicSection(pokemonData);
                case 'info':
                    return createEmbeddedInfoSection(pokemonData);
                case 'caught_status':
                    return createEmbeddedCaughtStatusSection(pokemonData, options);
                case 'personal_info':
                    return createEmbeddedPersonalInfoSection(pokemonData, options);
                case 'catch_details':
                    return createEmbeddedCatchDetailsSection(pokemonData, options);
                case 'encounter_info':
                    return createEmbeddedEncounterInfoSection(pokemonData, options);
                case 'battle_stats':
                    return createEmbeddedBattleStatsSection(pokemonData, options);
                case 'moves':
                    return createEmbeddedMovesSection(pokemonData, options, containerId);
                default:
                    return null;
            }
        }

        function createEmbeddedActionButton(actionType, options, containerId) {
            const button = document.createElement('button');
            button.className = 'pokemon-button-retro';
            
            switch(actionType) {
                case 'close':
                    button.textContent = 'CLOSE';
                    button.className += ' secondary';
                    button.onclick = () => console.log(`${containerId}: Close action`);
                    break;
                case 'catch':
                    button.textContent = 'CATCH!';
                    button.className += ' success';
                    button.onclick = () => console.log(`${containerId}: Catch action`);
                    break;
                case 'run_away':
                    button.textContent = 'RUN AWAY';
                    button.className += ' secondary';
                    button.onclick = () => console.log(`${containerId}: Run away action`);
                    break;
                case 'rename':
                    button.textContent = 'RENAME';
                    button.className += ' primary';
                    button.onclick = () => console.log(`${containerId}: Rename action`);
                    break;
                case 'release':
                    button.textContent = 'RELEASE';
                    button.className += ' danger';
                    button.onclick = () => console.log(`${containerId}: Release action`);
                    break;
                default:
                    return null;
            }
            
            return button;
        }

        // Simplified section creators for embedded cards
        function createEmbeddedBasicSection(pokemonData) {
            // Basic section removed - ID moved to overlay, saving space
            return null;
        }

        function createEmbeddedInfoSection(pokemonData) {
            const section = document.createElement('div');
            section.className = 'pokemon-card-section-content';
            section.innerHTML = `
                <div class="pokemon-text-small" style="text-align: center; font-style: italic;">
                    "${pokemonData.description || 'A mysterious Pokemon.'}"
                </div>
            `;
            return section;
        }

        function createEmbeddedCaughtStatusSection(pokemonData, options) {
            const isCaught = options.caughtPokemon || false;
            const section = document.createElement('div');
            section.className = 'pokemon-card-section-content';
            section.innerHTML = `
                <div style="text-align: center; font-weight: bold; color: ${isCaught ? 'var(--pokemon-green)' : 'var(--pokemon-red)'};">
                    ${isCaught ? '‚úÖ CAUGHT!' : '‚ùå NOT CAUGHT'}
                </div>
            `;
            return section;
        }

        function createEmbeddedPersonalInfoSection(pokemonData, options) {
            const caughtPokemon = options.caughtPokemon || {};
            const section = document.createElement('div');
            section.className = 'pokemon-card-section-content';
            section.innerHTML = `
                <div class="pokemon-text-small" style="text-align: center;">
                    <strong>Level ${caughtPokemon.level || 1}</strong> | 
                    <strong>EXP:</strong> ${caughtPokemon.experience || 0}<br>
                    <strong>Nickname:</strong> ${caughtPokemon.nickname || 'None'}
                    ${caughtPokemon.isShiny ? '<br><span style="color: gold;">‚ú® SHINY ‚ú®</span>' : ''}
                </div>
            `;
            return section;
        }

        function createEmbeddedCatchDetailsSection(pokemonData, options) {
            const caughtPokemon = options.caughtPokemon || {};
            const section = document.createElement('div');
            section.className = 'pokemon-card-section-content';
            section.innerHTML = `
                <div class="pokemon-text-small" style="text-align: center;">
                    <strong>Training Bonus:</strong><br>
                    HP +${(caughtPokemon.hp || pokemonData.baseHp) - pokemonData.baseHp} | 
                    ATK +${(caughtPokemon.attack || pokemonData.baseAttack) - pokemonData.baseAttack}
                </div>
            `;
            return section;
        }

        function createEmbeddedEncounterInfoSection(pokemonData, options) {
            const pokeballCount = options.pokeballCount || 0;
            const section = document.createElement('div');
            section.className = 'pokemon-card-section-content';
            section.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-weight: bold; margin-bottom: var(--space-xs);">POKEBALLS: ${pokeballCount}</div>
                    ${pokeballCount === 0 ? '<div style="color: var(--pokemon-red); font-size: var(--font-size-xs);">Complete minigame to catch!</div>' : ''}
                </div>
            `;
            return section;
        }

        function createEmbeddedBattleStatsSection(pokemonData, options) {
            const caughtPokemon = options.caughtPokemon || {};
            const battleStats = options.battleStats || {};
            const currentHP = battleStats.currentHP || caughtPokemon.currentHP || pokemonData.baseHp;
            const maxHP = battleStats.maxHP || caughtPokemon.hp || pokemonData.baseHp;
            const statusEffect = battleStats.statusEffect || caughtPokemon.statusEffect;
            
            const section = document.createElement('div');
            section.className = 'pokemon-card-section-content';
            section.innerHTML = `
                <div style="text-align: center;">
                    <div class="pokemon-text-small"><strong>HP:</strong> ${currentHP} / ${maxHP}</div>
                    <div class="hp-bar-container" style="margin: var(--space-xs) auto; width: 80%;">
                        <div class="hp-bar" style="width: ${(currentHP/maxHP)*100}%; background: ${pokemonCards.getHPBarColor(currentHP, maxHP)};"></div>
                    </div>
                    ${statusEffect ? `<div style="color: var(--pokemon-red); font-size: var(--font-size-xs); text-transform: uppercase;">${statusEffect}</div>` : ''}
                </div>
            `;
            return section;
        }

        function createEmbeddedMovesSection(pokemonData, options, containerId) {
            const moves = options.moves || ['Tackle', 'Growl'];
            const section = document.createElement('div');
            section.className = 'pokemon-card-section-content';
            section.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-xs);">
                    ${moves.map(move => `
                        <button class="pokemon-btn pokemon-btn-primary" style="font-size: var(--font-size-xs); padding: var(--space-xs);" 
                                onclick="console.log('${containerId}: Used ${move}')">
                            ${move}
                        </button>
                    `).join('')}
                </div>
            `;
            return section;
        }

        // Dummy Bulbasaur data for testing
        const bulbasaurData = {
            id: 1,
            name: 'bulbasaur',
            types: [
                { type: { name: 'grass' } },
                { type: { name: 'poison' } }
            ],
            sprites: {
                official_artwork: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/1.png',
                front_default: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/1.png'
            },
            baseHp: 45,
            baseAttack: 49,
            baseDefence: 49,
            baseSpeed: 45,
            generation: 1,
            legendary: false,
            description: 'A strange seed was planted on its back at birth. The plant sprouts and grows with this Pok√©mon.'
        };

        // Dummy caught Pokemon data (with training)
        const caughtBulbasaurData = {
            name: 'bulbasaur',
            nickname: 'Bulby',
            level: 15,
            experience: 2847,
            hp: 65,           // trainedHP: baseHP + training
            attack: 68,       // trainedAttack: baseAttack + training  
            defense: 67,      // trainedDefense: baseDefense + training
            speed: 52,        // trainedSpeed: baseSpeed + training
            dateCaught: '2025-07-20',
            isShiny: false,
            wins: 7,
            losses: 2,
            currentHP: 65,    // For battle context
            statusEffect: null
        };

        // Dummy shiny caught Pokemon data
        const shinyCaughtBulbasaurData = {
            ...caughtBulbasaurData,
            nickname: 'Golden Bulby',
            level: 22,
            experience: 4891,
            hp: 78,
            attack: 79,
            defense: 82,
            speed: 61,
            isShiny: true,
            wins: 15,
            losses: 1,
            currentHP: 45,    // Damaged in battle
            statusEffect: 'poisoned'
        };

        function goHome() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
